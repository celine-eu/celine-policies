realm: celine

# =============================================================================
# SCOPES
# =============================================================================
# Convention: {service}.{resource}.{action} or {service}.{action}
# Special: {service}.admin grants full access to that service
# Service prefix always matches the suffix of svc-{service} client_id
# =============================================================================

scopes:
  # Digital Twin
  - name: digital-twin.admin
    description: Full access to Digital Twin service
  - name: digital-twin.values.read
    description: Read digital twin values
  - name: digital-twin.values.write
    description: Write digital twin values
  - name: digital-twin.simulation.read
    description: Read simulation data
  - name: digital-twin.simulation.write
    description: Write simulation data
  - name: digital-twin.simulation.run
    description: Execute simulations
  - name: digital-twin.app.run
    description: Execute digital twin apps

  # Pipelines
  - name: pipelines.admin
    description: Full access to Pipeline service
  - name: pipelines.runs.read
    description: Read pipeline runs
  - name: pipelines.runs.write
    description: Update pipeline runs
  - name: pipelines.job.read
    description: Read job details
  - name: pipelines.job.write
    description: Modify job configuration

  # Dataset
  - name: dataset.admin
    description: Full access to Dataset service (includes restricted datasets)
  - name: dataset.query
    description: Execute dataset queries
  - name: dataset.read
    description: Read dataset metadata and schema
  - name: dataset.write
    description: Write dataset data

  # REC Registry
  - name: rec-registry.admin
    description: Full administrative access to the registry
  - name: rec-registry.import
    description: Permission to import into the registry
  - name: rec-registry.export
    description: Permission to export from the registry
  - name: rec-registry.lookup
    description: Permission to lookup data

  # Nudging
  - name: nudging.admin
    description: Admin nudging
  - name: nudging.notify
    description: Send notifications

  # MQTT
  - name: mqtt.admin
    description: MQTT superuser access

# =============================================================================
# CLIENTS
# =============================================================================
# Each client gets scopes for:
#   1. Its own resources (what it manages) — declared via scopes_prefix
#   2. Dependencies (other services it needs to call)
#
# scopes_prefix: declares ownership of a scope family. The CLI uses this to:
#   - Validate that "own" scopes belong to the right client
#   - Automatically add audience mappers on clients that reference foreign scopes
#
# Clients without scopes_prefix (mqtt, celine-cli) are exempt from audience mapping.
# =============================================================================

clients:
  - client_id: svc-digital-twin
    name: Digital Twin Service
    secret: ${SVC_DT_SECRET:-svc-digital-twin}
    scopes_prefix: digital-twin
    default_scopes:
      # Own resources
      - digital-twin.admin
      # Dependencies
      - dataset.query # needs to read datasets  → aud: svc-dataset-api
      - pipelines.runs.read # subscribes to pipeline updates → aud: svc-pipelines
      - nudging.notify # send notifications
      - rec-registry.lookup # lookup registry assets

  - client_id: svc-pipelines
    name: Pipeline Orchestrator
    secret: ${SVC_PIPELINES_SECRET:-svc-pipelines}
    scopes_prefix: pipelines
    default_scopes:
      # Own resources
      - pipelines.runs.read
      - pipelines.runs.write

  - client_id: svc-dataset-api
    name: Dataset API Service
    secret: ${SVC_DATASET_SECRET:-svc-dataset-api}
    scopes_prefix: dataset
    default_scopes:
      - dataset.admin # owns datasets

  - client_id: svc-nudging
    name: Nudging Service
    secret: ${SVC_NUDGING_SECRET:-svc-nudging}
    scopes_prefix: nudging
    default_scopes:
      - nudging.admin

  - client_id: svc-rec-registry
    name: REC Registry Service
    secret: ${SVC_REC_REGISTRY_SECRET:-svc-rec-registry}
    scopes_prefix: rec-registry
    default_scopes:
      # Own resources
      - rec-registry.admin

  - client_id: celine-cli
    name: CELINE Admin CLI
    secret: ${CELINE_ADMIN_CLI_SECRET:-celine-cli}
    # No scopes_prefix — sudo client, exempt from audience mapper generation
    default_scopes:
      - digital-twin.admin
      - pipelines.admin
      - dataset.admin
      - mqtt.admin
      - rec-registry.admin
