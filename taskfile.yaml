version: "3"

tasks:
  run:
    desc: "Run development server"
    cmds:
      - uv run uvicorn celine.mqtt_auth.main:create_app --reload --host 0.0.0.0 --port 8009

  debug:
    desc: "Run development server with debugger"
    cmds:
      - DEBUG_ATTACH=nowait DEBUG_PORT=48009 uv run uvicorn celine.mqtt_auth.main:create_app --reload --host 0.0.0.0 --port 8009

  test:
    desc: "Run test"
    cmds:
      - uv run pytest

  release:
    cmds:
      - uv run semantic-release -v version --no-vcs-release
      - git push
      - git push --tags

  keycloak:sync:
    cmds:
      - uv run celine-policies keycloak bootstrap --admin-user admin --admin-password admin
      - uv run celine-policies keycloak sync
